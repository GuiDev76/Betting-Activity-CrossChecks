<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard D√©tection Fraude</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useMemo } = React;

        const FraudDetectionDashboard = () => {
            const [data, setData] = useState(null);
            const [timeWindow, setTimeWindow] = useState(15);
            const [selectedEvent, setSelectedEvent] = useState(null);
            const [sortBy, setSortBy] = useState('time');
            const [activeTab, setActiveTab] = useState('clusters');
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [showDebug, setShowDebug] = useState(false);
            const [uploadLog, setUploadLog] = useState([]);

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const log = [`üìÅ ${file.name} (${(file.size/1024).toFixed(2)}KB)`];
                try {
                    const isExcel = file.name.match(/\.xlsx?$/i);
                    let parsed;
                    if (isExcel) {
                        if (!window.XLSX) { alert('Excel lib error'); return; }
                        const buf = await file.arrayBuffer();
                        const wb = XLSX.read(buf, {type:'array'});
                        parsed = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {raw:false, defval:''});
                        log.push(`‚úÖ ${parsed.length} lignes`);
                    } else {
                        const txt = await file.text();
                        const lines = txt.split('\n');
                        const sep = (lines[0].match(/,/g)||[]).length > (lines[0].match(/;/g)||[]).length ? ',' : ';';
                        const headers = lines[0].split(sep);
                        parsed = lines.slice(1).filter(l=>l.trim()).map(l => {
                            const v = l.split(sep);
                            return headers.reduce((o,h,i) => ({...o, [h.trim()]: v[i]?.trim()||''}), {});
                        });
                        log.push(`‚úÖ ${parsed.length} lignes`);
                    }
                    setUploadLog(log);
                    setData(parsed);
                } catch(err) {
                    log.push(`‚ùå ${err.message}`);
                    setUploadLog(log);
                    setShowDebug(true);
                    alert('Erreur: '+err.message);
                }
            };

            const areOpposite = (s1, s2, m) => {
                const a=s1.toLowerCase(), b=s2.toLowerCase();
                if(m?.toLowerCase().includes('winner')) return a!==b;
                return (a.includes('over')&&b.includes('under'))||(a.includes('under')&&b.includes('over'))||
                       (a.includes('+')&&b.includes('-'))||(a.includes('-')&&b.includes('+'));
            };

            const fraudClusters = useMemo(() => {
                if(!data) return [];
                const cls=[], proc=new Set();
                
                data.forEach((bet,idx) => {
                    if(proc.has(idx)) return;
                    let bt;
                    try {
                        const [d,t] = bet['Placement Time']?.split(' ')||[];
                        const [dy,mo,yr] = d?.split('/')||[];
                        const [h,m] = t?.split(':')||[];
                        bt = new Date(yr,mo-1,dy,h,m);
                    } catch(e) { return; }
                    if(isNaN(bt)) return;

                    const same = data.map((b,i)=>({...b,originalIndex:i})).filter((b,i)=>{
                        if(i===idx) return false;
                        let t2;
                        try {
                            const [d,t]=(b['Placement Time']||'').split(' ');
                            const [dy,mo,yr]=d.split('/');
                            const [h,m]=t.split(':');
                            t2=new Date(yr,mo-1,dy,h,m);
                        } catch(e) { return false; }
                        if(isNaN(t2)) return false;
                        const diff=Math.abs(t2-bt)/(1000*60);
                        return b.Event===bet.Event && b.Market===bet.Market && 
                               b['Selection Name']===bet['Selection Name'] && 
                               b['Party ID']!==bet['Party ID'] && diff<=timeWindow;
                    });

                    if(same.length>0) {
                        const all=[{...bet,originalIndex:idx},...same];
                        all.forEach(b=>proc.add(b.originalIndex));
                        const times=all.map(b=>{
                            try{
                                const[d,t]=b['Placement Time'].split(' ');
                                const[dy,mo,yr]=d.split('/');
                                const[h,m]=t.split(':');
                                return new Date(yr,mo-1,dy,h,m);
                            }catch(e){return null;}
                        }).filter(t=>t&&!isNaN(t));
                        const minT=new Date(Math.min(...times)), maxT=new Date(Math.max(...times));
                        const span=(maxT-minT)/(1000*60);
                        const stakes=all.map(b=>parseFloat(b['Total Stake'])||0);
                        const avg=stakes.reduce((a,b)=>a+b,0)/stakes.length;
                        const players=[...new Set(all.map(b=>b['Party ID']))];
                        const sels=[...new Set(all.map(b=>b['Selection Name']))];
                        const mkts=[...new Set(all.map(b=>b.Market))];
                        
                        cls.push({
                            event:bet.Event, selections:sels, markets:mkts,
                            sport:bet['Sport Type Name'], competition:bet.Competition,
                            players, allBets:all, timeSpan:span, firstBet:minT, lastBet:maxT,
                            totalStake:stakes.reduce((a,b)=>a+b,0), avgStake:avg,
                            fraudType:'bonus_abuser', allSameSelection:true, allSameMarket:true,
                            severity:span<=5?'critical':span<=15?'high':'medium'
                        });
                    }

                    const opp = data.map((b,i)=>({...b,originalIndex:i})).filter((b,i)=>{
                        if(i===idx||proc.has(i)) return false;
                        let t2;
                        try {
                            const [d,t]=(b['Placement Time']||'').split(' ');
                            const [dy,mo,yr]=d.split('/');
                            const [h,m]=t.split(':');
                            t2=new Date(yr,mo-1,dy,h,m);
                        } catch(e) { return false; }
                        if(isNaN(t2)) return false;
                        const diff=Math.abs(t2-bt)/(1000*60);
                        return b.Event===bet.Event && b.Market===bet.Market && 
                               areOpposite(bet['Selection Name'],b['Selection Name'],bet.Market) &&
                               b['Party ID']!==bet['Party ID'] && diff<=timeWindow;
                    });

                    if(opp.length>0) {
                        const all=[{...bet,originalIndex:idx},...opp];
                        all.forEach(b=>proc.add(b.originalIndex));
                        const times=all.map(b=>{
                            try{
                                const[d,t]=b['Placement Time'].split(' ');
                                const[dy,mo,yr]=d.split('/');
                                const[h,m]=t.split(':');
                                return new Date(yr,mo-1,dy,h,m);
                            }catch(e){return null;}
                        }).filter(t=>t&&!isNaN(t));
                        const minT=new Date(Math.min(...times)), maxT=new Date(Math.max(...times));
                        const span=(maxT-minT)/(1000*60);
                        const stakes=all.map(b=>parseFloat(b['Total Stake'])||0);
                        const avg=stakes.reduce((a,b)=>a+b,0)/stakes.length;
                        const players=[...new Set(all.map(b=>b['Party ID']))];
                        const sels=[...new Set(all.map(b=>b['Selection Name']))];
                        const mkts=[...new Set(all.map(b=>b.Market))];
                        
                        cls.push({
                            event:bet.Event, selections:sels, markets:mkts,
                            sport:bet['Sport Type Name'], competition:bet.Competition,
                            players, allBets:all, timeSpan:span, firstBet:minT, lastBet:maxT,
                            totalStake:stakes.reduce((a,b)=>a+b,0), avgStake:avg,
                            fraudType:'money_laundering', allSameSelection:false, allSameMarket:true,
                            severity:span<=5?'critical':span<=15?'high':'medium'
                        });
                    }
                });

                let sorted=[...cls];
                if(sortBy==='time') sorted.sort((a,b)=>a.timeSpan-b.timeSpan);
                else if(sortBy==='players') sorted.sort((a,b)=>b.players.length-a.players.length);
                else if(sortBy==='severity') {
                    const ord={critical:0,high:1,medium:2};
                    sorted.sort((a,b)=>ord[a.severity]-ord[b.severity]);
                }
                return sorted;
            }, [data,timeWindow,sortBy]);

            const playerAnalysis = useMemo(() => {
                if(!fraudClusters.length) return [];
                const pm=new Map();
                fraudClusters.forEach(c => {
                    c.players.forEach(pid => {
                        if(!pm.has(pid)) pm.set(pid,{id:pid,clustersCount:0,totalStake:0,events:[],associates:new Set(),betsCount:0});
                        const pd=pm.get(pid);
                        pd.clustersCount++;
                        pd.events.push({event:c.event,date:c.firstBet,sport:c.sport});
                        c.allBets.filter(b=>b['Party ID']===pid).forEach(b=>{
                            pd.totalStake+=parseFloat(b['Total Stake']||0);
                            pd.betsCount++;
                        });
                        c.players.forEach(op=>{if(op!==pid)pd.associates.add(op);});
                    });
                });
                return Array.from(pm.values()).map(p=>({...p,associates:Array.from(p.associates)}))
                    .sort((a,b)=>b.clustersCount-a.clustersCount);
            }, [fraudClusters]);

            const stats = useMemo(() => {
                if(!fraudClusters.length) return null;
                const up=new Set();
                fraudClusters.forEach(c=>c.players.forEach(p=>up.add(p)));
                return {
                    totalClusters:fraudClusters.length,
                    criticalClusters:fraudClusters.filter(c=>c.severity==='critical').length,
                    suspiciousPlayers:up.size,
                    totalStakeInvolved:fraudClusters.reduce((s,c)=>s+c.totalStake,0),
                    bonusAbusers:fraudClusters.filter(c=>c.fraudType==='bonus_abuser').length,
                    moneyLaundering:fraudClusters.filter(c=>c.fraudType==='money_laundering').length
                };
            }, [fraudClusters]);

            const exportResults = () => {
                if(!fraudClusters.length) return;
                const csv = [
                    ['√âv√©nement','Markets','S√©lections','Joueurs','Nb Joueurs','√âcart(min)','Type','S√©v√©rit√©','Mise Tot','Mise Moy'].join(';'),
                    ...fraudClusters.map(c=>[
                        c.event,c.markets.join('/'),c.selections.join('/'),c.players.join('|'),
                        c.players.length,c.timeSpan.toFixed(2),
                        c.fraudType==='bonus_abuser'?'BONUS':c.fraudType==='money_laundering'?'BLANCHIMENT':'AUTRE',
                        c.severity==='critical'?'CRITIQUE':c.severity==='high'?'√âLEV√â':'MOYEN',
                        c.totalStake.toFixed(2),c.avgStake.toFixed(2)
                    ].join(';'))
                ].join('\n');
                const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});
                const url=URL.createObjectURL(blob);
                const a=document.createElement('a');
                a.href=url;
                a.download=`fraude_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const getSevColor = s => s==='critical'?'bg-red-100 border-red-500':s==='high'?'bg-orange-100 border-orange-500':'bg-yellow-100 border-yellow-500';
            const getSevBadge = s => s==='critical'?'bg-red-600':s==='high'?'bg-orange-600':'bg-yellow-600';
            const getFraudBadge = f => f==='bonus_abuser'?{bg:'bg-green-600',txt:'üéÅ BONUS ABUSER',desc:'M√™me s√©lection'}:
                f==='money_laundering'?{bg:'bg-red-600',txt:'‚ö†Ô∏è BLANCHIMENT',desc:'S√©lections oppos√©es'}:
                {bg:'bg-orange-600',txt:'üîç SUSPECT',desc:'Comportement inhabituel'};

            if(!data) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-12">
                                <h1 className="text-4xl font-bold text-white mb-4">üîç D√©tection de Fraude</h1>
                                <p className="text-slate-300">Identifiez les r√©seaux de comptes frauduleux</p>
                            </div>
                            <div className="bg-white rounded-2xl shadow-2xl p-12">
                                <div className="flex flex-col items-center">
                                    <label className="cursor-pointer">
                                        <input type="file" accept=".csv,.xlsx,.xls" onChange={handleFileUpload} className="hidden"/>
                                        <div className="px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl">
                                            üìÅ S√©lectionner fichier (CSV/Excel)
                                        </div>
                                    </label>
                                    <div className="mt-12 w-full max-w-2xl grid gap-4">
                                        <div className="bg-green-50 rounded-lg p-4 border-l-4 border-green-600">
                                            <div className="font-semibold text-green-900 mb-2">üéÅ Bonus Abuser</div>
                                            <div className="text-sm text-green-700">M√™me market + m√™me s√©lection</div>
                                        </div>
                                        <div className="bg-red-50 rounded-lg p-4 border-l-4 border-red-600">
                                            <div className="font-semibold text-red-900 mb-2">‚ö†Ô∏è Blanchiment</div>
                                            <div className="text-sm text-red-700">M√™me market + s√©lections oppos√©es</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-sm p-6 mb-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-900">üîç D√©tection de Fraude</h1>
                                    <p className="text-gray-600 mt-1">{data.length} paris analys√©s</p>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={exportResults} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                        üíæ Exporter
                                    </button>
                                    <label className="cursor-pointer px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        üìÅ Nouveau
                                        <input type="file" accept=".csv,.xlsx,.xls" onChange={handleFileUpload} className="hidden"/>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-sm mb-6">
                            <div className="flex border-b border-gray-200">
                                <button onClick={()=>setActiveTab('clusters')} 
                                    className={`px-6 py-4 font-medium ${activeTab==='clusters'?'border-b-2 border-blue-600 text-blue-600':'text-gray-600'}`}>
                                    üìä Clusters ({fraudClusters.length})
                                </button>
                                <button onClick={()=>setActiveTab('players')} 
                                    className={`px-6 py-4 font-medium ${activeTab==='players'?'border-b-2 border-blue-600 text-blue-600':'text-gray-600'}`}>
                                    üë• Joueurs ({playerAnalysis.length})
                                </button>
                            </div>
                        </div>

                        {stats && (
                            <div className="grid grid-cols-6 gap-4 mb-6">
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Clusters</p>
                                    <p className="text-3xl font-bold text-gray-900">{stats.totalClusters}</p>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Critiques</p>
                                    <p className="text-3xl font-bold text-red-600">{stats.criticalClusters}</p>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Joueurs</p>
                                    <p className="text-3xl font-bold text-orange-600">{stats.suspiciousPlayers}</p>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Mise Tot</p>
                                    <p className="text-2xl font-bold text-gray-900">{stats.totalStakeInvolved.toFixed(0)}‚Ç¨</p>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Bonus</p>
                                    <p className="text-3xl font-bold text-green-600">{stats.bonusAbusers}</p>
                                </div>
                                <div className="bg-white rounded-xl shadow-sm p-6">
                                    <p className="text-sm text-gray-600">Blanch.</p>
                                    <p className="text-3xl font-bold text-red-600">{stats.moneyLaundering}</p>
                                </div>
                            </div>
                        )}

                        {showDebug && uploadLog.length>0 && (
                            <div className="bg-yellow-50 border-l-4 border-yellow-500 rounded-xl p-6 mb-6">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold text-yellow-900">üîç Debug</h3>
                                    <button onClick={()=>setShowDebug(false)} className="text-yellow-700 font-bold">‚úï</button>
                                </div>
                                <div className="bg-white rounded p-4 space-y-2 font-mono text-sm">
                                    {uploadLog.map((l,i)=><div key={i} className={l.includes('‚ùå')?'text-red-700':l.includes('‚úÖ')?'text-green-700':'text-gray-700'}>{l}</div>)}
                                </div>
                            </div>
                        )}

                        {activeTab==='clusters' ? (
                            <>
                                <div className="bg-white rounded-xl shadow-sm p-4 mb-6">
                                    <div className="flex gap-6">
                                        <label className="flex items-center gap-2">
                                            <span className="text-sm font-medium">‚è±Ô∏è Fen√™tre:</span>
                                            <select value={timeWindow} onChange={e=>setTimeWindow(+e.target.value)} 
                                                className="px-3 py-2 border rounded-lg">
                                                <option value={5}>5 min</option>
                                                <option value={15}>15 min</option>
                                                <option value={30}>30 min</option>
                                                <option value={60}>60 min</option>
                                            </select>
                                        </label>
                                        <label className="flex items-center gap-2">
                                            <span className="text-sm font-medium">üîΩ Trier:</span>
                                            <select value={sortBy} onChange={e=>setSortBy(e.target.value)} 
                                                className="px-3 py-2 border rounded-lg">
                                                <option value="time">√âcart temporel</option>
                                                <option value="severity">Gravit√©</option>
                                                <option value="players">Nb joueurs</option>
                                            </select>
                                        </label>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    {fraudClusters.map((c,i)=>(
                                        <div key={i} className={`bg-white rounded-xl shadow-sm border-l-4 ${getSevColor(c.severity)} p-6 cursor-pointer`}
                                            onClick={()=>setSelectedEvent(selectedEvent===i?null:i)}>
                                            <div className="flex justify-between mb-4">
                                                <div className="flex-1">
                                                    <div className="flex gap-3 mb-2 flex-wrap">
                                                        <span className={`px-3 py-1 rounded-full text-xs font-bold text-white ${getSevBadge(c.severity)}`}>
                                                            ‚è±Ô∏è {c.timeSpan.toFixed(1)}min
                                                        </span>
                                                        <span className={`px-3 py-1 rounded-full text-xs font-bold text-white ${getFraudBadge(c.fraudType).bg}`}>
                                                            {getFraudBadge(c.fraudType).txt}
                                                        </span>
                                                    </div>
                                                    <h3 className="text-lg font-semibold">{c.event}</h3>
                                                    <p className="text-sm text-gray-600">{c.competition}</p>
                                                    <p className="text-xs text-gray-500 italic">{getFraudBadge(c.fraudType).desc}</p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-sm text-gray-600">Joueurs</p>
                                                    <p className="text-2xl font-bold">{c.players.length}</p>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 rounded-lg p-4 mb-4">
                                                <p className="text-sm font-medium mb-2">üìä Market: {c.markets.join(', ')}</p>
                                                <div className="flex gap-2 flex-wrap">
                                                    {c.selections.map((s,j)=><span key={j} className="px-3 py-1 bg-white border rounded-lg text-sm font-semibold">{s}</span>)}
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-4 gap-4 text-sm">
                                                <div><p className="text-gray-600">‚è∞ Premier</p><p className="font-medium">{c.firstBet.toLocaleTimeString('fr-FR')}</p></div>
                                                <div><p className="text-gray-600">‚è∞ Dernier</p><p className="font-medium">{c.lastBet.toLocaleTimeString('fr-FR')}</p></div>
                                                <div><p className="text-gray-600">üíµ Total</p><p className="font-medium">{c.totalStake.toFixed(2)}‚Ç¨</p></div>
                                                <div><p className="text-gray-600">üíµ Moyen</p><p className="font-medium">{c.avgStake.toFixed(2)}‚Ç¨</p></div>
                                            </div>
                                            {selectedEvent===i && (
                                                <div className="mt-6 pt-6 border-t space-y-2">
                                                    <h4 className="font-semibold mb-3">üìã D√©tail ({c.allBets.length} paris)</h4>
                                                    {c.allBets.map((b,j)=>(
                                                        <div key={j} className="flex justify-between p-3 bg-gray-50 rounded-lg flex-wrap gap-4">
                                                            <div className="flex gap-4 flex-wrap">
                                                                <span className="font-mono text-sm font-semibold text-blue-600">üë§ {b['Party ID']}</span>
                                                                <span className="text-sm text-gray-600">üïê {b['Placement Time']}</span>
                                                                <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">{b.Market}</span>
                                                                <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">{b['Selection Name']}</span>
                                                            </div>
                                                            <div className="flex gap-4">
                                                                <span className="text-sm font-medium">üíµ {b['Total Stake']}‚Ç¨</span>
                                                                <span className={`px-2 py-1 rounded text-xs ${b['Bet Status']==='Won'?'bg-green-100 text-green-800':b['Bet Status']==='Lost'?'bg-red-100 text-red-800':'bg-gray-100 text-gray-800'}`}>
                                                                    {b['Bet Status']==='Won'?'‚úÖ':b['Bet Status']==='Lost'?'‚ùå':'‚è∏Ô∏è'} {b['Bet Status']}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                {fraudClusters.length===0 && (
                                    <div className="bg-white rounded-xl shadow-sm p-12 text-center">
                                        <div className="text-6xl mb-4">‚úÖ</div>
                                        <h3 className="text-xl font-semibold mb-2">Aucune fraude d√©tect√©e</h3>
                                    </div>
                                )}
                            </>
                        ) : (
                            <div className="space-y-4">
                                {playerAnalysis.length===0 ? (
                                    <div className="bg-white rounded-xl p-12 text-center">
                                        <div className="text-6xl mb-4">üë§</div>
                                        <h3 className="text-xl font-semibold">Aucun joueur suspect</h3>
                                    </div>
                                ) : playerAnalysis.map((p,i)=>(
                                    <div key={i} className="bg-white rounded-xl shadow-sm p-6 cursor-pointer" 
                                        onClick={()=>setSelectedPlayer(selectedPlayer===p.id?null:p.id)}>
                                        <div className="flex justify-between mb-4">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-bold mb-3">üë§ Joueur #{p.id}</h3>
                                                <div className="grid grid-cols-4 gap-4">
                                                    <div className="bg-red-50 rounded-lg p-3">
                                                        <p className="text-xs text-red-600">Clusters</p>
                                                        <p className="text-2xl font-bold text-red-900">{p.clustersCount}</p>
                                                    </div>
                                                    <div className="bg-orange-50 rounded-lg p-3">
                                                        <p className="text-xs text-orange-600">Associ√©s</p>
                                                        <p className="text-2xl font-bold text-orange-900">{p.associates.length}</p>
                                                    </div>
                                                    <div className="bg-blue-50 rounded-lg p-3">
                                                        <p className="text-xs text-blue-600">Paris</p>
                                                        <p className="text-2xl font-bold text-blue-900">{p.betsCount}</p>
                                                    </div>
                                                    <div className="bg-green-50 rounded-lg p-3">
                                                        <p className="text-xs text-green-600">Mise</p>
                                                        <p className="text-2xl font-bold text-green-900">{p.totalStake.toFixed(0)}‚Ç¨</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {selectedPlayer===p.id && (
                                            <div className="mt-6 pt-6 border-t space-y-6">
                                                <div>
                                                    <h4 className="font-semibold mb-3">üîó Associ√©s ({p.associates.length})</h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {p.associates.map((a,j)=>
                                                            <span key={j} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-lg text-sm font-semibold cursor-pointer hover:bg-blue-200"
                                                                onClick={e=>{e.stopPropagation();setSelectedPlayer(a);}}>
                                                                üë§ #{a}
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                                <div>
                                                    <h4 className="font-semibold mb-3">üìã √âv√©nements ({p.events.length})</h4>
                                                    <div className="space-y-2">
                                                        {p.events.map((e,j)=>(
                                                            <div key={j} className="flex justify-between p-3 bg-gray-50 rounded-lg">
                                                                <div>
                                                                    <p className="font-medium">{e.event}</p>
                                                                    <p className="text-sm text-gray-600">{e.sport}</p>
                                                                </div>
                                                                <p className="text-sm text-gray-600">{e.date.toLocaleString('fr-FR')}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FraudDetectionDashboard />);
    </script>
</body>
</html>
